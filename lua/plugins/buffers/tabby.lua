----   ╭────────────────────────────────╮      ____  __    ___  ____  __    ____  ____  ____       │
----   │ ⠐⠉⣿                            │     (  __)/ _\  / __)(  __)(  )  (  __)/ ___)/ ___)      │
----   │⢀⡀ ⣿                            │      ) _)/    \( (__  ) _) / (_/\ ) _) \___ \\___ \      │
----   │⠘⠳⠶⠛⠀⠀⠀⠀      ⠀⢀⣠⠤⠤⠤⣄⠀⠀⠀⠀⠀⠀⠀⠀⠀  │     (__) \_/\_/ \___)(____)\____/(____)(____/(____/      │
----   │ ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⡠⠊⠁⣠⣶⣶⠞⠃⢠⣹⣷⠀⠀⠀⠀⠀⠀  │             __  ____  ____  ____  ____  ____             │
----   │ ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⡞⠀⠀⣼⣿⣿⠃⠀⠀⠀⠉⠁⠀⠀⠀⠀⠀⠀  │           _(  )(  __)/ ___)(_  _)(  __)(  _ \            │
----   │ ⠀⠀⠀⠀⢀⣠⣤⣤⣤⣀⢸⠀⠀⠀⣿⣿⣿⡀⠀⣀⡠⠤⠤⢤⣀⠀⠀⠀⠀  │          / \) \ ) _) \___ \  )(   ) _)  )   /            │
----   │ ⠀⠀⢀⣾⣿⣿⠿⣿⣿⣿⣿⠀⠀⠀⣿⣿⣿⡷⠊⠀⠀⠀⠀⣀⠀⠙⢆⠀⠀  │          \____/(____)(____/ (__) (____)(__\_)            │
----   │ ⠀⠀⣾⡟⢁⣀⡀⠀⠈⠻⣿⠀⠀⠀⢹⣿⣿⠁⠀⠀⣠⣾⣿⣿⣿⣷⡌⡆⠀  │                                                          │
----   │ ⠀⠀⢻⡵⠁⠀⠈⢢⠀⠀⢹⡆⠀⢀⣀⣻⣇⣀⣀⣰⣿⣿⡿⠋⠁⠈⢻⠇⠀  │  ╓                                                       │
----   │ ⠀⠀⠈⠥⣄⠀⠀⠀⣇⣴⠶⠿⠛⠛⠉⠉⠉⠙⠛⠛⠻⢿⠀⠀⠀⢀⠐⣤⠀  │  ║  Довольно просто различить шута и дурака:             │
----   │  ⠀⠘⠿⠟⠀⠀⠀⡟⠁⠀⠀⠀⠀⠀⠀⠰⡄⢀⣀⠀⣼⠀⠀⠀⠘⠿⠟⠀  │  ║  Ведь, тот — дурак, кто на шута взирает свысока!      │
----   │ ⠀⠀⠀⠀⠀⠀⠀⠀⣷⣀⣇⠀⠀⠀⢀⣠⣴⣿⠟⠁⠀⣿⠀⠀⠀⠀⠀⠀⠀  │  ╙                                                       │
----   │ ⠀⠀⠀⠀⠀⠀⠀⠀⠈⣏⢻⠛⠃⠀⠀⠉⠉⠹⡄⠀⠀⢹⠀⠀⠀⠀⠀⠀⠀  │                                                          │
----   │  ⠀⠀⠀⠀⠀⠀⠀⠀⠘⣆⠁⠀⠺⠂   ⠁⠀⢀⡟⠀⠀⠀⠀⠀⠀⠀  │                                                          │
----   │ ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠘⢦⡀ ⠺⠂  ⠀⣠⠏⠀⠀⠀⠀⠀⠀⠀⠀  │                                                          │
----   │ ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠙⢦⡀⠺⠂⣠⠞⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀  │        ╭── GitHub ─────────────────────────────╮         │
----   │ ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠙⠛⠋⠀⠀⠀⠀⠀⠀⠀⠀⠀  ⠔⢲⡆│                                                          │
----   │                              ⢸⡇│            https://github.com/facelessJester             │
----   │                            ⠿⣤⡼⠇│                                                          │
----   ╰────────────────────────────────╯        ╰────────────────────────────── GitHub ─╯         │
----
---------------------------------------------------------------------------------------------------
----                 ╔═══════════════════════════════════════════════════════════╗
----                 ║                                                           ║
----                 ║                           TABBY                           ║
----                 ║                                                           ║
----                 ╚═══════════════════════════════════════════════════════════╝
local theme = {
    head = 'TabbyHead',
    cur_tab = 'TabbyCurrentTab',
    tab = 'TabbyTab',
    tab_uns_buf = "TabbyTabUns",
    tab_cur_uns_buf = "TabbyCurrentTabUns",
    fill = 'TabbyFill',
    win = 'TabbyWin',
    cur_win = 'TabbyCurrentWin',
    win_uns_buf = "TabbyWinUns",
    win_cur_uns_buf = "TabbyCurrentWinUns",
    tail = 'TabbyTail'
}
vim.o.showtabline = 2
require('tabby').setup({
    line = function(line)
        return {
            { { ' 󰏩 ', hl = theme.head }, line.sep('', theme.head, theme.fill) },
            line.tabs().foreach(function(tab)
                local is_changed = false
                local _ = tab.wins().foreach(function(win)
                    is_changed = is_changed or win.buf().is_changed()
                    return " "
                end)
                local hl_tab = tab.is_current() and theme.cur_tab or theme.tab
                local hl_sym = is_changed and
                                   (tab.is_current() and theme.tab_cur_uns_buf or
                                       theme.tab_uns_buf) or hl_tab

                return {
                    line.sep('', hl_tab, theme.fill),
                    {
                        is_changed and (tab.is_current() and '' or '') or tab.is_current() and
                            '󰺕' or '󰄰',
                        hl = hl_sym
                    },
                    tab.number(),
                    tab.name(),
                    line.sep('', hl_tab, theme.fill),
                    hl = hl_tab,
                    margin = ' '
                }
            end),
            line.spacer(),
            line.wins_in_tab(line.api.get_current_tab()).foreach(function(win)
                local hl_win = win.is_current() and theme.cur_win or theme.win
                local hl_sym = win.buf().is_changed() and
                                   (win.is_current() and theme.win_cur_uns_buf or
                                       theme.win_uns_buf) or hl_win
                return {
                    line.sep('', hl_win, theme.fill),
                    win.buf_name(),
                    {
                        win.buf().is_changed() and (win.is_current() and '' or '') or
                            win.is_current() and '󰺕' or '󰄰',
                        hl = hl_sym
                    },
                    line.sep('', hl_win, theme.fill),
                    hl = hl_win,
                    margin = ' '
                }
            end),
            { line.sep('', theme.tail, theme.fill), { '  ', hl = theme.tail } },
            hl = theme.fill
        }
    end
})
